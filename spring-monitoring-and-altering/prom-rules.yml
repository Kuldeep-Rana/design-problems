groups:
  - name: spring-apps
    rules:
      - alert: HighErrorRate
        expr: |
          sum(rate(http_server_requests_seconds_count{status=~"5.."}[2m])) by (instance) 
          /
          sum(rate(http_server_requests_seconds_count[2m])) by (instance) > 0.05
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "High 5xx rate on {{ $labels.instance }}"
          description: "5xx error rate > 5% in last 2m."

      - alert: HighLatencyP95
        expr: histogram_quantile(0.95, sum(rate(http_server_requests_seconds_bucket[2m])) by (le, instance)) > 1
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "High p95 latency on {{ $labels.instance }}"
          description: "p95 latency > 1s in last 2m."
